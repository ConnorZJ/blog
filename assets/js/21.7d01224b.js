(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{352:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"spring-boot-之静态资源访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot-之静态资源访问"}},[s._v("#")]),s._v(" spring boot 之静态资源访问")]),s._v(" "),a("p",[s._v("以前在springMVC项目之中，如果需要访问静态资源的话，一般是需要在spring-mvc.xml文件中配置以下代码：")]),s._v(" "),a("div",{staticClass:"language-xml line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-xml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("mvc:")]),s._v("resources")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapping")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/images/**"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("location")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/images/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("mvc:")]),s._v("resources")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapping")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/js/**"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("location")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/js/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token tag"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),a("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("mvc:")]),s._v("resources")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("mapping")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/css/**"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("location")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')]),s._v("/css/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v('"')])]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("/>")])]),s._v(" \n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br")])]),a("p",[s._v("但是在springboot之中，访问静态资源的方式就更加的简单粗暴了！")]),s._v(" "),a("p",[s._v("下面来看看在springboot中如何访问静态资源。")]),s._v(" "),a("h2",{attrs:{id:"开始分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#开始分析"}},[s._v("#")]),s._v(" 开始分析")]),s._v(" "),a("p",[s._v("第一步肯定是创建项目啦~依赖选择web即可。")]),s._v(" "),a("p",[s._v("首先搜索类"),a("strong",[s._v("WebMvcAutoConfiguration")]),s._v("，再找到其内部类"),a("strong",[s._v("WebMvcAutoConfigurationAdapter")]),s._v("，定位到它的"),a("strong",[s._v("addResourceHandlers")]),s._v("方法，可以看到有一个staticPathPattern变量")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413225427.png",alt:""}})]),s._v(" "),a("p",[s._v("点进去看一看这个变量的值")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("staticPathPattern "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/**"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("这个就是类似于在springMVC中配置的location，两个**表示的是匹配任意一层路径。")]),s._v(" "),a("p",[s._v("再看下面一行的源码，这个比较长，主要要看的是this.resourceProperties.getStaticLocations()。")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("customizeResourceHandlerRegistration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addResourceHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("String")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("staticPathPattern"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addResourceLocations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcAutoConfiguration")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getResourceLocations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("resourceProperties"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getStaticLocations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCachePeriod")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSeconds")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cachePeriod"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCacheControl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cacheControl"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v('看到这个点进去看，就能看到其实这个staticLocations的值是一个String的数组，元素有四个分别是"classpath:/META-INF/resources/"、"classpath:/resources/"、"classpath:/static/"、"classpath:/public/"。于是可以猜测，在springboot中，静态资源可以放在以上四个路径下，且优先级是按照顺序从高到低排序的。')]),s._v(" "),a("p",[s._v("再返回到刚刚很长的一行代码的地方，在点击WebMvcAutoConfiguration.getResourceLocations()方法，可以看到：返回了locations数组里面，除了之前提到的四个路径，还有一个"),a("strong",[s._v("SERVLET_LOCATIONS")]),s._v('的东西，这个东西的值就是一个斜杠（"/"），对应的就是当前项目的根路径。')]),s._v(" "),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413230821.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413230938.png",alt:""}})]),s._v(" "),a("p",[s._v("所以现在猜测，在springboot中，静态资源的默认映射路径分别为：")]),s._v(" "),a("ul",[a("li",[s._v("classpath:/META-INF/resources/")]),s._v(" "),a("li",[s._v("classpath:/resources/")]),s._v(" "),a("li",[s._v("classpath:/static/")]),s._v(" "),a("li",[s._v("classpath:/public/")]),s._v(" "),a("li",[s._v("/")])]),s._v(" "),a("p",[s._v("接下来就是验证我们的猜测是否正确的时候了！")]),s._v(" "),a("h2",{attrs:{id:"验证猜测"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证猜测"}},[s._v("#")]),s._v(" 验证猜测")]),s._v(" "),a("p",[s._v("首先我们在项目下分别在各自的路径创建五个location.js文件，里面就写上各自的路径")]),s._v(" "),a("p",[a("img",{attrs:{src:"C:%5CUsers%5C10203%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200413232428801.png",alt:"image-20200413232428801"}})]),s._v(" "),a("p",[s._v("启动项目，访问"),a("a",{attrs:{href:"localhost:8080/location.js"}},[s._v("localhost:8080/location.js")]),s._v("，打印了一条，就删掉相应路径的location.js，看看将会打印出了什么。")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("classpath:/META-INF/resources/\nclasspath:/resources/\nclasspath:/static/\nclasspath:/public/\nwebapp:/\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br")])]),a("p",[s._v("通过上述打印的信息可以判断，我们之前的猜测是正确的！")]),s._v(" "),a("h2",{attrs:{id:"自定义路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#自定义路径"}},[s._v("#")]),s._v(" 自定义路径")]),s._v(" "),a("p",[s._v("通过上面的操作，我们知道了springboot中关于静态资源的默认的访问路径，但我想访问自定义路径的静态资源怎么办呢？")]),s._v(" "),a("p",[s._v("其实这样也是可以的！首先看看之前看的源码"),a("strong",[s._v("staticLocations")]),s._v("的地方，这个变量所在的类上有个注解是定义了这个前缀是spring.resources")]),s._v(" "),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413233302.png",alt:""}})]),s._v(" "),a("p",[s._v("所以我们在application.properties中，配置一个这个前缀加上staticLocations的配置，就可以实现自定义的静态资源的访问路径了。")]),s._v(" "),a("div",{staticClass:"language-properties line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-properties"}},[a("code",[a("span",{pre:!0,attrs:{class:"token attr-name"}},[s._v("spring.resources.static-locations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token attr-value"}},[s._v("classpath:/myresources/")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413233645.png",alt:""}})]),s._v(" "),a("p",[a("img",{attrs:{src:"http://qiniuyun.zijie.fun/20200413233655.png",alt:""}})]),s._v(" "),a("p",[s._v("除了配置properties之外，还有另一种方式---那肯定就是通过注解的方式来配置啦~")]),s._v(" "),a("p",[s._v("首先注释掉properties的内容避免干扰，然后在包中创建一个类，重要的是实现"),a("strong",[s._v("WebMvcConfigurer")]),s._v("接口，并重写"),a("strong",[s._v("addResourceHandlers")]),s._v("方法，代码如下：")]),s._v(" "),a("div",{staticClass:"language-java line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfig")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("implements")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("WebMvcConfigurer")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Override")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("void")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addResourceHandlers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("ResourceHandlerRegistry")]),s._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addResourceHandler")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/**"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("addResourceLocations")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v('"classpath:/myresources/"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);